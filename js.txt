document.addEventListener('DOMContentLoaded', () => {
    const countdownElement = document.getElementById('countdown');
    const duration = 30 * 60 * 1000; // 30 minutos en milisegundos

    // 1. Obtener la hora de expiración
    let expiryTime = localStorage.getItem('countdownExpiry');

    // Si no existe o ya expiró, establece una nueva hora de expiración (hora actual + 30 minutos)
    if (!expiryTime || new Date().getTime() > expiryTime) {
        expiryTime = new Date().getTime() + duration;
        localStorage.setItem('countdownExpiry', expiryTime);
    } else {
        // Asegurarse de que el valor almacenado sea un número
        expiryTime = parseInt(expiryTime, 10);
    }

    // 2. Función para actualizar el contador
    function updateCountdown() {
        const now = new Date().getTime();
        const distance = expiryTime - now;

        if (distance < 0) {
            clearInterval(interval);
            countdownElement.innerHTML = "¡OFERTA EXPIRADA!";
            // Opcional: deshabilitar el botón CTA aquí si quieres forzar la expiración.
            return;
        }

        // Cálculos de tiempo
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Formato con ceros iniciales
        const formattedMinutes = String(minutes).padStart(2, '0');
        const formattedSeconds = String(seconds).padStart(2, '0');

        countdownElement.innerHTML = `${formattedMinutes}:${formattedSeconds}`;
    }

    // 3. Iniciar el contador y actualizar cada segundo
    updateCountdown();
    const interval = setInterval(updateCountdown, 1000);
});